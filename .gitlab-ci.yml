stages:
  - build_linux
  - build_windows
linux:
  stage: build_linux
  tags:
    - qtdeploy
  variables:
    GIT_STRATEGY: clone
    GIT_SUBMODULE_STRATEGY: recursive
    GIT_SUBMODULE_FORCE_HTTPS: "true"
  script:
    - cmake -B build/linux -S . -DCMAKE_PREFIX_PATH=${CI_QT_PATH} -DCI_TOOLS_PATH=${CI_TOOLS_PATH}
    - cmake --build build/linux -j$(nproc) -- 2> ./build/linux/log_build.txt
    - cmake --build build/linux --target deployment
  artifacts:
    paths:
      - ./build/linux/deployment/
    expire_in: 1 week
windows:
  stage: build_windows
  tags:
    - qtdeploy
  variables:
    GIT_STRATEGY: clone
    GIT_SUBMODULE_STRATEGY: recursive
    GIT_SUBMODULE_FORCE_HTTPS: "true"
  script:
    - rm -rf build && mkdir build && cd build
    - export PATH=${CI_MXE_PATH}/usr/bin/:$PATH
    - ${CI_MXE_PATH}/usr/bin/x86_64-w64-mingw32.shared-cmake ..
    - make -j4
  artifacts:
    paths:
      - ./build/windows/
    expire_in: 1 week
